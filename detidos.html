<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detidos ‚Äî Tipo x Quantidade</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    /* ======= BASE / TEMA NEON AZUL ======= */
    *{box-sizing:border-box}
    :root{
      --bg1:#07051a; --bg2:#0f0b2d; --bg3:#14123b;
      --text:#eaf1ff; --muted:rgba(202,214,255,.78);
      --grad-a:#00e6ff; --grad-b:#2f7bff; --grad-c:#7c4dff;
      --brd: rgba(120,160,255,.22);
      --glass: rgba(18,25,61,.55);
      --shadow: 0 25px 50px rgba(0,0,0,.35);
      --sidebar-w: 280px; --sidebar-w-collapsed: 72px;
    }
    html,body{height:100%}
    body{margin:0; font-family:'Inter','Segoe UI',system-ui,Arial,sans-serif; color:var(--text);
      background:linear-gradient(135deg,var(--bg1),var(--bg2) 50%,var(--bg3));}
    body::before{content:""; position:fixed; inset:0; z-index:-1; pointer-events:none;
      background:
       radial-gradient(60rem 60rem at 20% 50%, rgba(0,230,255,.16) 0%, transparent 55%),
       radial-gradient(42rem 42rem at 80% 20%, rgba(124,77,255,.14) 0%, transparent 60%),
       radial-gradient(40rem 40rem at 40% 80%, rgba(47,123,255,.12) 0%, transparent 60%);
      filter:saturate(1.1);
    }
    .hidden{display:none}

    /* ======= LAYOUT + MENU ANIMADO ======= */
    .app{display:grid; grid-template-columns: var(--sidebar-w) 1fr; min-height:100vh; transition:grid-template-columns .25s ease}
    .app.collapsed{grid-template-columns: var(--sidebar-w-collapsed) 1fr}

    #sidebar{position:sticky; top:0; align-self:start; min-height:100vh; background:rgba(9,14,40,.88); border-right:1px solid var(--brd); backdrop-filter: blur(12px); box-shadow:var(--shadow)}
    .sb-row{display:flex; align-items:center; gap:10px; padding:14px 12px}
    .sb-head{border-bottom:1px solid var(--brd)}
    .dot{width:10px; height:10px; border-radius:999px; background:linear-gradient(135deg,var(--grad-a),var(--grad-b)); box-shadow:0 0 10px rgba(0,230,255,.6)}
    #menuBtn{appearance:none; background:transparent; color:var(--text); border:1px solid var(--brd); border-radius:10px; padding:8px 10px; cursor:pointer}

    .nav{display:flex; flex-direction:column; padding:8px}
    .nav a{display:flex; align-items:center; gap:12px; padding:10px 12px; margin:4px 0; border-radius:12px; color:#cfe6ff; text-decoration:none; border:1px solid transparent; white-space:nowrap; overflow:hidden}
    .nav a:hover{background:rgba(10,25,70,.45); border-color:var(--brd)}
    .nav a.active{color:#fff; background:linear-gradient(135deg, rgba(0,230,255,.08), rgba(47,123,255,.08)); border-color:rgba(120,170,255,.35); box-shadow:0 0 12px rgba(0,230,255,.35)}
    .nav .ico{width:28px; display:inline-grid; place-items:center; font-size:18px}
    .nav .label{opacity:1; transition:opacity .2s ease, transform .2s ease}
    .app.collapsed .nav .label{opacity:0; transform:translateX(-6px); width:0; margin:0; padding:0}
    .app.collapsed #menuBtn .label{display:none}

    .content{padding:22px}
    .container{max-width:1200px; margin:0 auto; background:linear-gradient(180deg, var(--glass), rgba(10,12,30,.45)); border:1px solid rgba(120,160,255,.18); border-radius:24px; padding:24px; box-shadow:var(--shadow)}
    .header{text-align:center; margin-bottom:18px; position:relative}
    .header::before{content:""; position:absolute; top:-10px; left:50%; transform:translateX(-50%); width:260px; height:4px; border-radius:2px; background:linear-gradient(90deg,var(--grad-a),var(--grad-b),var(--grad-c)); box-shadow:0 0 16px rgba(0,230,255,.45)}
    h1{font-size:clamp(1.8rem,1.2rem + 2.2vw,3rem); font-weight:900; letter-spacing:.3px; margin:6px 0; background:linear-gradient(135deg,var(--grad-a),var(--grad-b),var(--grad-c)); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent}

    .cards{display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:16px; margin-bottom:14px}
    .card{background:linear-gradient(135deg, rgba(0,230,255,.9), rgba(47,123,255,.9)); color:#fff; padding:18px; border-radius:18px; text-align:center}
    .card h3{font-size:2rem; margin:0 0 4px}

    .panel{background:linear-gradient(180deg, rgba(14,18,48,.7), rgba(8,10,28,.6)); border:1px solid var(--brd); border-radius:18px; overflow:hidden}
    .panel-hd{background:linear-gradient(135deg,var(--grad-a),var(--grad-b)); padding:14px 16px; font-weight:900}
    .row{display:grid; grid-template-columns:1fr auto; align-items:center; gap:16px; padding:16px; border-top:1px solid rgba(130,160,255,.16)}
    .row:first-child{border-top:none}
    .row:hover{background:rgba(10,25,70,.35)}
    .pill{min-width:120px; text-align:center; padding:8px 12px; border-radius:10px; background:rgba(10,25,70,.55); border:1px solid rgba(120,170,255,.25)}

    /* FAB + SCRIM (mobile) */
    #fabMenu{position:fixed; bottom:18px; right:18px; z-index:6; appearance:none; background:linear-gradient(135deg,var(--grad-a),var(--grad-b)); color:#031224; border:none; border-radius:14px; padding:12px 14px; box-shadow:var(--shadow); display:none}
    .scrim{position:fixed; inset:0; background:rgba(0,0,0,.45); backdrop-filter:blur(2px); z-index:5; opacity:0; pointer-events:none; transition:opacity .2s ease}
    .scrim.show{opacity:1; pointer-events:auto}

    @media (max-width:1024px){
      #fabMenu{display:block}
      #sidebar{position:fixed; left:0; top:0; bottom:0; width:var(--sidebar-w); transform:translateX(-110%); transition:transform .25s ease}
      #sidebar.open{transform:translateX(0)}
      .app{grid-template-columns:1fr}
    }
    @media (max-width:720px){
      .row{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <button id="fabMenu" aria-label="Abrir menu" title="Abrir menu">‚ò∞</button>
  <div class="scrim" id="scrim"></div>

  <div class="app collapsed" id="app">
    <aside id="sidebar" aria-label="Menu lateral">
      <div class="sb-row sb-head">
        <span class="dot" aria-hidden="true"></span>
        <button id="menuBtn" aria-expanded="false" aria-controls="sidebar" title="Menu">‚ò∞ <span class="label">Menu</span></button>
      </div>
      <!-- Menu Lateral -->
  <nav class="sidebar" aria-label="Menu lateral">
    <div class="logo"><h2>Ocorr√™ncias</h2></div>
    <ul class="menu-list">
      <li class="menu-item">
        <a href="#inicial" class="menu-link active" data-section="inicial">üè† <span>Inicial</span></a>
      </li>

      <!-- Link EXTERNO: abre drogas.html (n√£o √© interceptado pelo JS) -->
      <li class="menu-item">
        <a href="/Ocorrencia/drogas.html" class="menu-link external">üíä <span>Drogas Apreendidas</span></a>
      </li>
      <li class="menu-item">
        <a href="detidos.html" class="menu-link" data-section="equipes">üë• <span>Equipes</span></a>
      </li>
      <li class="menu-item">
        <a href="#regioes" class="menu-link" data-section="regioes">üåç <span>Regi√µes</span></a>
      </li>
      <li class="menu-item">
        <a href="#horarios" class="menu-link" data-section="horarios">‚è∞ <span>Hor√°rios</span></a>
      </li>
      
    </ul>
  </nav>

    <main class="content">
      <div class="container">
        <div class="header">
          <h1>Detidos ‚Äî Tipo x Quantidade</h1>
          <div class="subtitle">Resumo agregado por tipo</div>
        </div>

        <div id="cards" class="cards hidden"></div>

        <section id="panel" class="panel hidden" aria-live="polite">
          <div class="panel-hd">üëÆ Detidos (Tipo | Quantidade)</div>
          <div id="list"></div>
        </section>
      </div>
    </main>
  </div>

  <script>
    // ===== Menu animado =====
    const app = document.getElementById('app');
    const menuBtn = document.getElementById('menuBtn');
    const sidebar = document.getElementById('sidebar');
    const fabMenu = document.getElementById('fabMenu');
    const scrim = document.getElementById('scrim');

    function setExpanded(exp){
      if(window.matchMedia('(max-width:1024px)').matches){
        sidebar.classList.toggle('open', !!exp);
        scrim.classList.toggle('show', !!exp);
        menuBtn.setAttribute('aria-expanded', !!exp);
      } else {
        app.classList.toggle('collapsed', !exp);
        menuBtn.setAttribute('aria-expanded', !!exp);
      }
    }
    setExpanded(false);
    menuBtn?.addEventListener('click', () => {
      if(window.matchMedia('(max-width:1024px)').matches){
        const isOpen = sidebar.classList.contains('open');
        setExpanded(!isOpen);
      } else {
        const isCollapsed = app.classList.contains('collapsed');
        setExpanded(isCollapsed);
      }
    });
    fabMenu?.addEventListener('click', () => setExpanded(true));
    scrim?.addEventListener('click', () => setExpanded(false));
    window.addEventListener('resize', ()=>{
      if(!window.matchMedia('(max-width:1024px)').matches){
        sidebar.classList.remove('open');
        scrim.classList.remove('show');
      }
    });

    // ===== Dados (Google Sheets) =====
    const sheetId = '1y0lXqmjBjxJm-mb4Ym7zm94tf_KqL_ub534w9hxSF2w';
    const url = `https://corsproxy.io/?${encodeURIComponent(`https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv`)}`;

    const $ = (sel) => document.querySelector(sel);
    const el = (tag, cls) => { const x = document.createElement(tag); if (cls) x.className = cls; return x; };
    const numberize = (v) => { if (v==null) return 0; const s=String(v).replace(/\./g,'').replace(/,/g,'.').replace(/[^0-9.-]/g,'').trim(); const n=s===''?0:Number(s); return Number.isFinite(n)?n:0; };

    let aggregated = {}; // tipo -> soma quantidade

    function formatInt(v){ return Number(v).toLocaleString('pt-BR'); }
    function createCard(val,label){ const c=el('div','card'); c.innerHTML=`<h3>${val}</h3><p>${label}</p>`; return c; }
    function makePill(label,val){ const d=el('div','pill'); d.innerHTML=`${label}<br><b>${val}</b>`; return d; }

    function render(){
      const tipos = Object.keys(aggregated);
      const soma = tipos.reduce((s,k)=> s+aggregated[k], 0);

      const wrap=$('#cards');
      wrap.innerHTML='';
      wrap.append(
        createCard(tipos.length,'Tipos de Detidos'),
        createCard(formatInt(soma),'Total de detidos')
      );
      wrap.classList.remove('hidden');

      const list=$('#list');
      list.innerHTML='';
      for(const [tipo,qt] of Object.entries(aggregated).sort((a,b)=> b[1]-a[1])){
        const row=el('div','row');
        row.innerHTML=`<div>${tipo}</div>`;
        row.append(makePill('Quantidade', formatInt(qt)));
        list.append(row);
      }
      $('#panel').classList.remove('hidden');
    }

    async function fetchCSV(){
      try{
        const res = await fetch(url);
        if(!res.ok) throw new Error('Falha ao obter CSV');
        const text = await res.text();
        const result = Papa.parse(text, { skipEmptyLines: 'greedy' }).data;
        const hasHeader = result[0]?.some?.(c=> String(c).toLowerCase().includes('tipo'));
        const rows = hasHeader ? result.slice(1) : result;
        aggregated = {};
        for(const r of rows){
          if(!r[0]) continue;
          const tipo = String(r[0]).trim();
          const qtd = numberize(r[1]);
          if(!aggregated[tipo]) aggregated[tipo]=0;
          aggregated[tipo]+= qtd;
        }
        render();
      }catch(e){
        console.error(e);
        alert('Erro ao carregar a planilha p√∫blica. Verifique o compartilhamento e o formato (2 colunas: Tipo, Quantidade).');
      }
    }

    window.addEventListener('load', fetchCSV);
  </script>
</body>
</html>
